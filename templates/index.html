{% extends "base.html" %}

{% block content %}

{% if errors %}
<div class="container">  
    {% for e in errors %}
        <div class="alert alert-danger" role="alert">
            {{ e }}
        </div>
    {% endfor %}
</div>
{% endif %}

<div class="container">
  <form action="/upload" method="POST" enctype="multipart/form-data">
    <div class="form-group">
      <label for="file">Select a file:</label>
      <input type="file" class="form-control-file" id="file" name="file[]" multiple>
    </div>
    <input type="submit" class="btn btn-link bg-dark" value="Submit">
  </form>
</div>

<div class="container" style="padding-bottom: 30px;"></div>

{% if response %}
<div class="container">
{% for r in response %}
    <div class="alert alert-success" role="alert">
        {{ r }}
    </div>
{% endfor %}
</div>

<div class="container">
    <button class="btn btn-link bg-dark text-light" onclick="download()">Download</button>
</div>

{% endif %}

<script>
function download() {
    var zip = new JSZip();
    var response = {{ response|tojson }};

    for (var i = 0; i < response.length; i++) {
      var filename = "myfile" + i + ".txt";
      var content = response[i];
      zip.file(filename, content);
    }

    zip.generateAsync({type:"blob"})
      .then(function(content) {
        var link = document.createElement('a');
        link.download = "myZip.zip";
        link.href = URL.createObjectURL(content);
        link.click();
      });
}
</script>

{% endblock %}
